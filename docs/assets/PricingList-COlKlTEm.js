import{Q as b}from"./QItemLabel-DmPoPUF3.js";import{c as Q,C as V,g as N,D as A,b as _,f as m,j as S,av as B,ax as O,a3 as U,a4 as R,_ as K,aF as M,aG as H,Z as j,S as p,K as o,P as n,J as I,N as s,L as i,R as d,X as L,Q as h,V as v,T as F,a8 as X,aa as E,aX as Y,U as q,aY as $,aZ as Z,a_ as T,H as z}from"./index-DSxTO65g.js";import{b as C,Q as k,a as g}from"./QItem-WZe3AiL8.js";import{Q as D}from"./QList-BMaD56vj.js";import{i as G,C as y}from"./index.esm-B0dn8-SH.js";import{s as J}from"./utils-C9eOA9OL.js";const W=Q({name:"QBanner",props:{...V,inlineActions:Boolean,dense:Boolean,rounded:Boolean},setup(t,{slots:e}){const{proxy:{$q:c}}=N(),f=A(t,c),l=_(()=>"q-banner row items-center"+(t.dense===!0?" q-banner--dense":"")+(f.value===!0?" q-banner--dark q-dark":"")+(t.rounded===!0?" rounded-borders":"")),r=_(()=>`q-banner__actions row items-center justify-end col-${t.inlineActions===!0?"auto":"all"}`);return()=>{const u=[m("div",{class:"q-banner__avatar col-auto row items-center self-start"},S(e.avatar)),m("div",{class:"q-banner__content col text-body2"},S(e.default))],a=S(e.action);return a!==void 0&&u.push(m("div",{class:r.value},a)),m("div",{class:l.value+(t.inlineActions===!1&&a!==void 0?" q-banner--top-padding":""),role:"alert"},u)}}}),ee=Q({name:"QInnerLoading",props:{...V,...B,showing:Boolean,color:String,size:{type:[String,Number],default:"42px"},label:String,labelClass:String,labelStyle:[String,Array,Object]},setup(t,{slots:e}){const c=N(),f=A(t,c.proxy.$q),{transitionProps:l,transitionStyle:r}=O(t),u=_(()=>"q-inner-loading q--avoid-card-border absolute-full column flex-center"+(f.value===!0?" q-inner-loading--dark":"")),a=_(()=>"q-inner-loading__label"+(t.labelClass!==void 0?` ${t.labelClass}`:""));function P(){const w=[m(R,{size:t.size,color:t.color})];return t.label!==void 0&&w.push(m("div",{class:a.value,style:t.labelStyle},[t.label])),w}function x(){return t.showing===!0?m("div",{class:u.value,style:r.value},e.default!==void 0?e.default():P()):null}return()=>m(U,l.value,x)}}),te={emits:["onCheckoutVerified"],data(){return{paddle:null,selectedPriceId:T.items[0].priceId,paddlePrices:[],isPricesLoading:!1,isCheckoutLoading:!1,isVerifyingSubs:!1,counterOfVerify:0,isCheckoutCompleted:!1}},computed:{...H(z,["loginToken","customer","isLoggedIn","hasActiveSubscription"]),isPaddleInitialized(){return this.paddle?.Initialized},isFromApp(){return this.$route.query.pid!=null}},methods:{...M(z,["refreshCustomer"]),goToCustomerPage(){this.$router.push("/customer").then(()=>{window.location.reload()})},async paddleEventCallback(t){t.name==y.CHECKOUT_LOADED?this.isCheckoutLoading=!1:t.name==y.CHECKOUT_COMPLETED?(this.paddle.Checkout.close(),this.isVerifyingSubs=!0,await J(3e3),this.isVerifyingSubs=!1,this.isCheckoutCompleted=!0):(t.name==y.CHECKOUT_ERROR||t.name==y.CHECKOUT_FAILED||t.name==y.CHECKOUT_CLOSED)&&(this.isCheckoutLoading=!1)},async initializePaddlePricings(){try{if(this.isPricesLoading=!0,this.paddle=await G({environment:Z?"sandbox":"production",token:$,checkout:{settings:{theme:"light",displayMode:"overlay"}},eventCallback:this.paddleEventCallback}),this.paddle.Initialized){const t=await this.paddle.PricePreview(T);this.paddlePrices=t.data.details.lineItems.map(e=>{let{id:c,name:f,description:l}=e.price,{discount:r,tax:u,total:a}=e.formattedTotals;return{id:c,name:f,description:l,discount:r,tax:u,total:a}}),this.isFromApp&&this.subscribeNow()}}catch(t){console.error("Initialization error:",t)}finally{this.isPricesLoading=!1}},async subscribeNow(){let t=this.customer?.easymeta__Email__c,e={items:[{priceId:this.selectedPriceId,quantity:1}]};if(t&&(e.customer={email:t}),this.isPaddleInitialized)try{this.isCheckoutLoading=!0,this.paddle.Checkout.open(e)}catch(c){console.error(`Checkout error: ${c.message}`)}}},async mounted(){this.initializePaddlePricings()}},se={class:"q-py-lg text-center bg-primary text-white"},ie={key:0,class:"text-center",style:{"margin-top":"100px"}},ae={class:"text-positive"},le={key:0,class:"text-center q-my-xl"},ne={key:0,class:"row justify-center q-ma-md"};function oe(t,e,c,f,l,r){const u=j("spa");return o(),p(v,null,[n("div",se,[s(b,{class:"text-h4"},{default:i(()=>e[3]||(e[3]=[d("Metaforce Subscriptions")])),_:1})]),l.isCheckoutCompleted?(o(),p("div",ie,[n("div",ae,[s(L,{size:"7rem",color:"positive",name:"verified"}),e[4]||(e[4]=n("div",{class:"text-h5 q-py-lg text-bold"},[d(" Congrats! "),n("br"),d("You have subscribed Metaforce successfully. ")],-1))]),e[5]||(e[5]=n("br",null,null,-1)),e[6]||(e[6]=n("div",null,"The detailed subscription information will be sent to your email address shortly.",-1)),s(h,{label:"View My Subscription",onClick:r.goToCustomerPage,class:"q-mt-md",color:"positive",style:{width:"200px"},"no-caps":"",outline:""},null,8,["onClick"])])):(o(),I(D,{key:1,class:"q-mx-xl q-mt-md"},{default:i(()=>[l.isPricesLoading?(o(),p("div",le,[s(C,{size:"md",color:"primary"}),e[7]||(e[7]=n("div",{class:"q-mt-md"},"Loading Subscription Plans ...",-1))])):(o(),p(v,{key:1},[t.hasActiveSubscription?(o(),p("div",ne,[s(W,{"inline-actions":"",rounded:"",class:"bg-positive text-white text-center"},{avatar:i(()=>[s(L,{name:"campaign"})]),action:i(()=>[s(h,{flat:"","no-caps":"",to:"/customer",label:"View"})]),default:i(()=>[s(u,null,{default:i(()=>e[8]||(e[8]=[d("You already have at least one active metaforce subscription.")])),_:1})]),_:1})])):F("",!0),s(k,{class:"q-pl-sm"},{default:i(()=>[s(g,{class:"text-body1",style:{"font-size":"25px"}},{default:i(()=>[s(b,null,{default:i(()=>e[9]||(e[9]=[d("Choose a subscription plan")])),_:1}),s(b,{caption:""},{default:i(()=>e[10]||(e[10]=[d("During the free trial or the subscription, you can cancel the subscription at any time.")])),_:1})]),_:1})]),_:1}),s(D,{bordered:"",separator:"",padding:""},{default:i(()=>[(o(!0),p(v,null,X(l.paddlePrices,(a,P)=>(o(),I(k,{key:P,tag:"label",class:E(a.id==l.selectedPriceId?"text-primary text-bold":""),clickable:""},{default:i(()=>[s(g,{avatar:""},{default:i(()=>[s(Y,{modelValue:l.selectedPriceId,"onUpdate:modelValue":e[0]||(e[0]=x=>l.selectedPriceId=x),val:a.id},null,8,["modelValue","val"])]),_:2},1024),s(g,null,{default:i(()=>[s(b,null,{default:i(()=>[d(q(a.name),1)]),_:2},1024),s(b,{class:E(a.id==l.selectedPriceId?"text-primary":""),caption:""},{default:i(()=>[d(q(a.description),1)]),_:2},1032,["class"])]),_:2},1024),s(g,{avatar:""},{default:i(()=>[s(b,null,{default:i(()=>[d(q(a.total),1)]),_:2},1024)]),_:2},1024)]),_:2},1032,["class"]))),128))]),_:1}),s(k,{class:"q-pa-none q-my-md"},{default:i(()=>[s(g,null,{default:i(()=>[t.isLoggedIn?(o(),I(h,{key:0,disabled:!r.isPaddleInitialized,loading:l.isCheckoutLoading,onClick:r.subscribeNow,label:"Subscribe Now",color:"white",class:"bg-positive",style:{"min-height":"50px"},flat:"",stretch:"","no-caps":""},{loading:i(()=>[s(C,{size:"sm"})]),_:1},8,["disabled","loading","onClick"])):(o(),p(v,{key:1},[e[11]||(e[11]=n("div",{class:"row justify-center items-center"},[n("span",{class:"q-ml-xs text-caption"},"Before the subscription, you have to sign in to or sign up for Metaforce.")],-1)),s(h,{label:"Sign In / Sign Up",onClick:e[1]||(e[1]=a=>t.$bus.emit("showLogin")),color:"white",class:"bg-positive",style:{"min-height":"50px"},flat:"",stretch:"","no-caps":""},{loading:i(()=>[s(C,{size:"sm"})]),_:1})],64))]),_:1})]),_:1}),s(k,{class:"q-pa-none q-mt-md"},{default:i(()=>[s(g,null,{default:i(()=>[s(h,{label:"Back",style:{"min-height":"50px"},onClick:e[2]||(e[2]=a=>t.$router.go(-1)),flat:"",stretch:"","no-caps":""})]),_:1})]),_:1})],64))]),_:1})),s(ee,{showing:l.isVerifyingSubs,style:{"background-color":"rgba(255,255,255,0.8)"},color:"primary",label:"Please wait..."},{default:i(()=>[n("div",null,[s(C,{color:"primary",size:"md"})]),e[12]||(e[12]=n("div",{class:"q-mt-md text-primary text-h6"}," Verifying your subscription... ",-1))]),_:1},8,["showing"])],64)}const fe=K(te,[["render",oe],["__scopeId","data-v-ccaa67c2"]]);export{fe as default};
