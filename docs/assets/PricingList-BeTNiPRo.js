import{Q as h}from"./QItemLabel-CycwUEQJ.js";import{c as V,C as N,g as A,D as M,b as _,f,j as S,aH as B,aI as O,a3 as Y,a4 as U,_ as $,aE as K,aF as R,Z as H,S as m,K as o,P as r,J as q,N as s,L as i,R as d,X as E,Q as g,V as v,T as L,a8 as j,aa as D,aJ as F,U as C,aK as W,aL as J,aM as T,H as z}from"./index-UmDEmY2c.js";import{Q as k}from"./QSpinnerBars-BAtTgt89.js";import{Q as P,a as b}from"./QItem-D1Z9YK3G.js";import{Q}from"./QList-Bsa96GtI.js";import{i as X,C as y}from"./index.esm-B0dn8-SH.js";import{s as G,h as Z}from"./utils-1NVuGABL.js";const ee=V({name:"QBanner",props:{...N,inlineActions:Boolean,dense:Boolean,rounded:Boolean},setup(t,{slots:e}){const{proxy:{$q:c}}=A(),p=M(t,c),n=_(()=>"q-banner row items-center"+(t.dense===!0?" q-banner--dense":"")+(p.value===!0?" q-banner--dark q-dark":"")+(t.rounded===!0?" rounded-borders":"")),l=_(()=>`q-banner__actions row items-center justify-end col-${t.inlineActions===!0?"auto":"all"}`);return()=>{const u=[f("div",{class:"q-banner__avatar col-auto row items-center self-start"},S(e.avatar)),f("div",{class:"q-banner__content col text-body2"},S(e.default))],a=S(e.action);return a!==void 0&&u.push(f("div",{class:l.value},a)),f("div",{class:n.value+(t.inlineActions===!1&&a!==void 0?" q-banner--top-padding":""),role:"alert"},u)}}}),te=V({name:"QInnerLoading",props:{...N,...B,showing:Boolean,color:String,size:{type:[String,Number],default:"42px"},label:String,labelClass:String,labelStyle:[String,Array,Object]},setup(t,{slots:e}){const c=A(),p=M(t,c.proxy.$q),{transitionProps:n,transitionStyle:l}=O(t),u=_(()=>"q-inner-loading q--avoid-card-border absolute-full column flex-center"+(p.value===!0?" q-inner-loading--dark":"")),a=_(()=>"q-inner-loading__label"+(t.labelClass!==void 0?` ${t.labelClass}`:""));function x(){const w=[f(U,{size:t.size,color:t.color})];return t.label!==void 0&&w.push(f("div",{class:a.value,style:t.labelStyle},[t.label])),w}function I(){return t.showing===!0?f("div",{class:u.value,style:l.value},e.default!==void 0?e.default():x()):null}return()=>f(Y,n.value,I)}}),se={emits:["onCheckoutVerified"],data(){return{paddle:null,selectedPriceId:T.items[0].priceId,paddlePrices:[],isPricesLoading:!1,isCheckoutLoading:!1,isVerifyingSubs:!1,counterOfVerify:0,isCheckoutCompleted:!1}},computed:{...R(z,["loginToken","customer","isLoggedIn","hasActiveSubscription"]),isPaddleInitialized(){return this.paddle?.Initialized},isFromApp(){return this.$route.query.pid!=null},tips(){let t=this.paddlePrices.find(e=>e.id==this.selectedPriceId);if(t){let e=Z().add(7,"days").format("MMM D, YYYY");return t.name.startsWith("1 Month")?`7 days free, then ${t.total} monthly starting from ${e}. You can cancel anytime before then.`:t.name.startsWith("3 Months")?`7 days free, then ${t.total} every 3 months starting ${e}. You can cancel anytime before then.`:t.name.startsWith("6 Months")?`7 days free, then ${t.total} every 6 months starting ${e}. You can cancel anytime before then.`:t.name.startsWith("12 Months")?`7 days free, then ${t.total} yearly starting ${e}. You can cancel anytime before then.`:t.name=="One Time Subscription"?"Gain lifetime access to Metaforce. Pay once, use forever.":null}else return null}},methods:{...K(z,["refreshCustomer"]),goToCustomerPage(){this.$router.push("/customer").then(()=>{window.location.reload()})},async paddleEventCallback(t){t.name==y.CHECKOUT_LOADED?this.isCheckoutLoading=!1:t.name==y.CHECKOUT_COMPLETED?(this.paddle.Checkout.close(),this.isVerifyingSubs=!0,await G(3e3),this.isVerifyingSubs=!1,this.isCheckoutCompleted=!0):(t.name==y.CHECKOUT_ERROR||t.name==y.CHECKOUT_FAILED||t.name==y.CHECKOUT_CLOSED)&&(this.isCheckoutLoading=!1)},async initializePaddlePricings(){try{if(this.isPricesLoading=!0,this.paddle=await X({environment:J?"sandbox":"production",token:W,checkout:{settings:{theme:"light",displayMode:"overlay"}},eventCallback:this.paddleEventCallback}),this.paddle.Initialized){const t=await this.paddle.PricePreview(T);this.paddlePrices=t.data.details.lineItems.map(e=>{let{id:c,name:p,description:n}=e.price,{discount:l,tax:u,total:a}=e.formattedTotals;return{id:c,name:p,description:n,discount:l,tax:u,total:a}}),this.isFromApp&&this.subscribeNow()}}catch(t){console.error("Initialization error:",t)}finally{this.isPricesLoading=!1}},async subscribeNow(){let t=this.customer?.easymeta__Email__c,e={items:[{priceId:this.selectedPriceId,quantity:1}]};if(t&&(e.customer={email:t}),this.isPaddleInitialized)try{this.isCheckoutLoading=!0,this.paddle.Checkout.open(e)}catch(c){console.error(`Checkout error: ${c.message}`)}}},async mounted(){this.initializePaddlePricings()}},ie={class:"q-py-lg text-center bg-primary text-white"},ae={key:0,class:"text-center",style:{"margin-top":"100px"}},ne={class:"text-positive"},le={key:0,class:"text-center q-my-xl"},oe={key:0,class:"row justify-center q-ma-md"},re={key:1,class:"q-mt-md text-center text-positive text-caption text-weight-medium"};function de(t,e,c,p,n,l){const u=H("spa");return o(),m(v,null,[r("div",ie,[s(h,{class:"text-h4"},{default:i(()=>e[3]||(e[3]=[d("Metaforce Subscriptions")])),_:1})]),n.isCheckoutCompleted?(o(),m("div",ae,[r("div",ne,[s(E,{size:"7rem",color:"positive",name:"verified"}),e[4]||(e[4]=r("div",{class:"text-h5 q-py-lg text-bold"},[d(" Congrats! "),r("br"),d("You have subscribed Metaforce successfully. ")],-1))]),e[5]||(e[5]=r("br",null,null,-1)),e[6]||(e[6]=r("div",null,"The detailed subscription information will be sent to your email address shortly.",-1)),s(g,{label:"View My Subscription",onClick:l.goToCustomerPage,class:"q-mt-md",color:"positive",style:{width:"200px"},"no-caps":"",outline:""},null,8,["onClick"])])):(o(),q(Q,{key:1,class:"q-mx-xl q-mt-md"},{default:i(()=>[n.isPricesLoading?(o(),m("div",le,[s(k,{size:"md",color:"primary"}),e[7]||(e[7]=r("div",{class:"q-mt-md"},"Loading Subscription Plans ...",-1))])):(o(),m(v,{key:1},[t.hasActiveSubscription?(o(),m("div",oe,[s(ee,{"inline-actions":"",rounded:"",class:"bg-positive text-white text-center"},{avatar:i(()=>[s(E,{name:"campaign"})]),action:i(()=>[s(g,{flat:"","no-caps":"",to:"/customer",label:"View"})]),default:i(()=>[s(u,null,{default:i(()=>e[8]||(e[8]=[d("You already have at least one active metaforce subscription.")])),_:1})]),_:1})])):L("",!0),s(P,{class:"q-pl-sm"},{default:i(()=>[s(b,{class:"text-body1",style:{"font-size":"25px"}},{default:i(()=>[s(h,null,{default:i(()=>e[9]||(e[9]=[d("Choose a subscription plan")])),_:1}),s(h,{caption:""},{default:i(()=>e[10]||(e[10]=[d("During the free trial or the subscription, you can cancel the subscription at any time.")])),_:1})]),_:1})]),_:1}),s(Q,{bordered:"",separator:"",padding:""},{default:i(()=>[(o(!0),m(v,null,j(n.paddlePrices,(a,x)=>(o(),q(P,{key:x,tag:"label",class:D(a.id==n.selectedPriceId?"text-primary text-bold":""),clickable:""},{default:i(()=>[s(b,{avatar:""},{default:i(()=>[s(F,{modelValue:n.selectedPriceId,"onUpdate:modelValue":e[0]||(e[0]=I=>n.selectedPriceId=I),val:a.id},null,8,["modelValue","val"])]),_:2},1024),s(b,null,{default:i(()=>[s(h,null,{default:i(()=>[d(C(a.name),1)]),_:2},1024),s(h,{class:D(a.id==n.selectedPriceId?"text-primary":""),caption:""},{default:i(()=>[d(C(a.description),1)]),_:2},1032,["class"])]),_:2},1024),s(b,{avatar:""},{default:i(()=>[s(h,null,{default:i(()=>[d(C(a.total),1)]),_:2},1024)]),_:2},1024)]),_:2},1032,["class"]))),128))]),_:1}),l.tips?(o(),m("div",re,C(l.tips),1)):L("",!0),s(P,{class:"q-pa-none q-my-md"},{default:i(()=>[s(b,null,{default:i(()=>[t.isLoggedIn?(o(),q(g,{key:0,disabled:!l.isPaddleInitialized,loading:n.isCheckoutLoading,onClick:l.subscribeNow,label:"Subscribe Now",color:"white",class:"bg-positive",style:{"min-height":"50px"},flat:"",stretch:"","no-caps":""},{loading:i(()=>[s(k,{size:"sm"})]),_:1},8,["disabled","loading","onClick"])):(o(),m(v,{key:1},[e[11]||(e[11]=r("div",{class:"row justify-center items-center"},[r("span",{class:"q-ml-xs text-caption"},"Before the subscription, you have to sign in to or sign up for Metaforce.")],-1)),s(g,{label:"Sign In / Sign Up",onClick:e[1]||(e[1]=a=>t.$bus.emit("showLogin")),color:"white",class:"bg-positive",style:{"min-height":"50px"},flat:"",stretch:"","no-caps":""},{loading:i(()=>[s(k,{size:"sm"})]),_:1})],64))]),_:1})]),_:1}),s(P,{class:"q-pa-none q-mt-md"},{default:i(()=>[s(b,null,{default:i(()=>[s(g,{label:"Back",style:{"min-height":"50px"},onClick:e[2]||(e[2]=a=>t.$router.go(-1)),flat:"",stretch:"","no-caps":""})]),_:1})]),_:1})],64))]),_:1})),s(te,{showing:n.isVerifyingSubs,style:{"background-color":"rgba(255,255,255,0.8)"},color:"primary",label:"Please wait..."},{default:i(()=>[r("div",null,[s(k,{color:"primary",size:"md"})]),e[12]||(e[12]=r("div",{class:"q-mt-md text-primary text-h6"}," Verifying your subscription... ",-1))]),_:1},8,["showing"])],64)}const ge=$(se,[["render",de],["__scopeId","data-v-b42a72bb"]]);export{ge as default};
